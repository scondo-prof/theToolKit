name: GitHub Issues Integration

on:
  workflow_call:
    inputs:
      trigger-log-issue-details:
        required: false
        type: boolean
        description: "Trigger log issue details"
        default: false
      trigger-periodic-issues-updates:
        required: false
        type: boolean
        description: "Trigger periodic issues updates"
        default: false

jobs:
  log_issue_details:
    runs-on: ubuntu-latest
    if: inputs.trigger-log-issue-details
    steps:
      - name: Echo key issue fields (quick)
        run: |
          echo "Trigger Action: ${{ github.event_name }} ${{ github.event.action }}"
          echo "Issue Title:    ${{ github.event.issue.title }}"
          echo "User:           ${{ github.event.issue.user.login }}"
          echo "Issue Number:   ${{ github.event.issue.number }}"
          echo "Issue State:    ${{ github.event.issue.state }}"
          echo "Issue URL:      ${{ github.event.issue.html_url }}"
          echo "Repository:     ${{ github.repository }}"
          echo ""
          echo "Trigger Reason: The workflow was triggered by an | ${{ github.event_name }} | event with action | ${{ github.event.action }} |"

      - name: Send to Discord
        uses: tsickert/discord-webhook@v7.0.0
        with:
          webhook-url: ${{ secrets.DISCORD_WEBHOOK_URL }}
          content: |
            ---
            # Issue Title: ${{ github.event.issue.title }}

            ## Issue Details:
            - **User:** ${{ github.event.issue.user.login }}
            - **Trigger Action:** ${{ github.event_name }} ${{ github.event.action }}
            - **Repository:** ${{ github.repository }}
            - **Issue Number:** ${{ github.event.issue.number }}
            - **Issue State:** ${{ github.event.issue.state }}
            - **Issue URL:** ${{ github.event.issue.html_url }}

  periodic_issues_updates:
    runs-on: ubuntu-latest
    if: inputs.trigger-periodic-issues-updates
    steps:
      - name: Get all issues
        run: |
          echo "Getting all issues"
          curl -X GET -H "Authorization: Bearer ${{ secrets.GITHUB_TOKEN }}" https://api.github.com/repos/${{ github.repository }}/issues | jq '.' > ISSUES_JSON.json

      - name: Read ISSUES_JSON.json
        run: |
          echo "Reading ISSUES_JSON.json"
          cat ISSUES_JSON.json

  test_job:
    runs-on: ubuntu-latest
    if: ${{ !inputs.trigger-log-issue-details && !inputs.trigger-periodic-issues-updates }}
    steps:
      - name: Echo test
        run: |
          echo "Test job"
